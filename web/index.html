<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SendMyNotice MVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        /* CSS TOOLTIP IMPLEMENTATION */
        .tooltip { position: relative; display: inline-block; cursor: pointer; }
        .tooltip .tooltip-text {
            visibility: hidden; width: 220px; background-color: #333; color: #fff;
            text-align: left; border-radius: 6px; padding: 8px; position: absolute;
            z-index: 1; bottom: 125%; left: 50%; margin-left: -110px;
            font-size: 0.75rem; line-height: 1.2; opacity: 0; transition: opacity 0.3s;
            font-weight: normal; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="bg-white p-8 rounded shadow-md w-full max-w-lg mb-8">
        <h1 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Send Preliminary Notice</h1>

        <form hx-post="/web/preview" hx-target="#result" hx-swap="innerHTML" class="space-y-4">            
            
            <div class="space-y-2">
                <div class="flex items-center gap-2 mb-2">
                    <h3 class="font-semibold text-gray-600 text-sm uppercase">Property Owner</h3>
                    <div class="tooltip">❓
                        <span class="tooltip-text">Legal Req: You must serve the legal owner. Use the tool below if unknown.</span>
                    </div>
                </div>

                <div id="owner-fields" class="space-y-2">
                    <input type="text" name="to_name" placeholder="Owner Name" required 
                           class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                    
                    <input type="text" name="to_address1" placeholder="Owner Address Line 1" required 
                           class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                    
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" name="to_city" placeholder="City" required 
                               class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" name="to_state" placeholder="State" value="CA" required 
                                   class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" name="to_zip" placeholder="Zip" required 
                                   class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t pt-4 mt-4">
                <h3 class="font-semibold text-gray-600 text-sm uppercase mb-3">Job Details</h3>
                
                <div class="mb-3">
                    <div class="flex items-center gap-2 mb-1">
                        <label class="text-xs text-gray-500">Description of Work</label>
                        <div class="tooltip">❓
                            <span class="tooltip-text">Legal Req: A "general description" (e.g., "Plumbing Fixtures").</span>
                        </div>
                    </div>
                    <input type="text" name="job_description" placeholder="e.g. Lumber, Framing, Labor" required class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div class="mb-3">
                    <div class="flex items-center gap-2 mb-1">
                        <label class="text-xs text-gray-500">Estimated Total Price ($)</label>
                        <div class="tooltip">❓
                            <span class="tooltip-text">Legal Req: A "Good Faith Estimate".</span>
                        </div>
                    </div>
                    <input type="text" name="estimated_price" id="price-input" placeholder="e.g. 5,000.00" required class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div class="mb-3">
                    <div class="flex items-center gap-2 mb-1">
                        <label class="text-xs text-gray-500">Your Role</label>
                    </div>
                    <select name="sender_role" class="w-full border p-2 rounded bg-white outline-none">
                        <option value="Material Supplier">Material Supplier</option>
                        <option value="Subcontractor">Subcontractor</option>
                        <option value="Direct Contractor">Direct Contractor</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="text-xs text-gray-500 mb-1">Construction Lender (Optional)</label>
                    <input type="text" name="lender_name" placeholder="Bank Name (if known)" class="w-full border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <input type="hidden" name="from_name" value="SendMyNotice Inc">
            <input type="hidden" name="from_address1" value="55 Devine St">
            <input type="hidden" name="from_city" value="San Jose">
            <input type="hidden" name="from_state" value="CA">
            <input type="hidden" name="from_zip" value="95110">

            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition duration-150">
                Preview Notice
            </button>
        </form>

        <div id="result" class="mt-6"></div>
    </div>

    <div class="w-full max-w-lg">
        <details class="bg-gray-200 rounded shadow-inner">
            <summary class="p-4 cursor-pointer font-bold text-gray-600 select-none flex justify-between">
                <span>Don't know the owner?</span>
                <span class="text-indigo-600">Use Lookup Tool ↓</span>
            </summary>
            
            <div class="p-4 border-t border-gray-300">
                <p class="text-xs text-gray-600 mb-4">
                    Enter the Job Site address below to search public tax records.
                </p>

                <form hx-post="/web/lookup-owner" 
                    hx-target="#owner-fields" 
                    hx-swap="outerHTML" 
                    class="space-y-3">
                    
                    <input type="text" name="to_address1" placeholder="Job Site Address" required 
                        class="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-500">
                    
                    <div class="grid grid-cols-3 gap-2">
                        <input type="text" name="to_city" placeholder="City" required class="w-full border p-2 rounded">
                        <input type="text" name="to_state" value="CA" class="w-full border p-2 rounded">
                        <input type="text" name="to_zip" placeholder="Zip" required class="w-full border p-2 rounded">
                    </div>

                    <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-2 rounded hover:bg-indigo-700">
                        Search & Autofill Form
                    </button>
                </form>
            </div>
        </details>
    </div>

    <script>
        const priceInput = document.getElementById('price-input');
        priceInput.addEventListener('input', function(e) {
            let value = this.value.replace(/[^\d.]/g, '');
            const parts = value.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            if (parts.length > 2) {
                value = parts[0] + "." + parts.slice(1).join('');
            } else {
                value = parts.join('.');
            }
            this.value = value;
        });
    </script>
</body>
</html>